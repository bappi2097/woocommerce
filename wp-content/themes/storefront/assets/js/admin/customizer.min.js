!function(n,i){"use strict";var s;n&&n.customize&&((s=n.customize).SFGuidedTourSteps=[],"undefined"!=typeof _wpCustomizeSFGuidedTourSteps&&i.extend(s.SFGuidedTourSteps,_wpCustomizeSFGuidedTourSteps),s.SFGuidedTour={$container:null,currentStep:-1,init:function(){this._setupUI()},_setupUI:function(){var t=this,e=i("body.wp-customizer .wp-full-overlay");this.$container=i("<div/>").addClass("sf-guided-tour"),e.prepend(this.$container),this._addListeners(),this.$container.css(i("body").hasClass("rtl")?"right":"left",i("#customize-controls").width()+10+"px").on("transitionend",function(){t.$container.addClass("sf-loaded")}),this._showNextStep(),i(document).on("click",".sf-guided-tour-step .sf-nux-button",function(){return t._showNextStep(),!1}),i(document).on("click",".sf-guided-tour-step .sf-guided-tour-skip",function(){return 0===t.currentStep?t._hideTour(!0):t._showNextStep(),!1})},_addListeners:function(){var t=this;s.state("expandedSection").bind(function(){t._adjustPosition()}),s.state("expandedPanel").bind(function(){t._adjustPosition()})},_adjustPosition:function(){var t=this._getCurrentStep(),e=s.state("expandedSection").get(),n=s.state("expandedPanel").get();t&&(this.$container.removeClass("sf-inside-section"),e&&t.section===e.id?(this._moveContainer(i(e.container[1]).find(".customize-section-title")),this.$container.addClass("sf-inside-section")):!1===e&&!1===n?this._isTourHidden()?this._revealTour():(t=this._getSelector(t.section),this._moveContainer(t)):this._hideTour())},_hideTour:function(t){var e=this;this._isTourHidden()||(this.$container.css({transform:"",top:this.$container.offset().top}),i("body").addClass("sf-exiting").on("animationend.storefront webkitAnimationEnd.storefront",function(){i(this).removeClass("sf-exiting").off("animationend.storefront webkitAnimationEnd.storefront").addClass("sf-hidden"),e.$container.hide(),_.isUndefined(t)||!0!==t||e._removeTour()}))},_revealTour:function(){var t=this;i("body").removeClass("sf-hidden"),t.$container.show(),i("body").addClass("sf-entering").on("animationend.storefront webkitAnimationEnd.storefront",function(){i(this).removeClass("sf-entering").off("animationend.storefront webkitAnimationEnd.storefront"),t.$container.css({top:"auto",transform:"translateY("+parseInt(t.$container.offset().top,10)+"px)"})})},_removeTour:function(){this.$container.remove()},_closeAllSections:function(){s.section.each(function(t){t.collapse({duration:0})}),s.panel.each(function(t){t.collapse({duration:0})})},_showNextStep:function(){var t,e;this._isLastStep()?this._hideTour(!0):(this._closeAllSections(),(t=this._getNextStep()).message=this._lineBreaksToParagraphs(t.message),e=n.template("sf-guided-tour-step"),this.$container.removeClass("sf-first-step"),0===this.currentStep&&(t.first_step=!0,this.$container.addClass("sf-first-step")),this._isLastStep()&&(t.last_step=!0,this.$container.addClass("sf-last-step")),this._moveContainer(this._getSelector(t.section)),this.$container.html(e(t)))},_moveContainer:function(t){var e=this;t&&(t=parseInt(t.offset().top,10)+t.height()/2-44,this.$container.addClass("sf-moving").css({transform:"translateY("+parseInt(t,10)+"px)"}).on("transitionend.storefront",function(){e.$container.removeClass("sf-moving"),e.$container.off("transitionend.storefront")}))},_getSelector:function(t){var e=s.section(t)?s.section(t):s.panel(t);return _.isUndefined(e)?i(t):i(e.container[0])},_getCurrentStep:function(){return s.SFGuidedTourSteps[this.currentStep]},_getNextStep:function(){return this.currentStep=this.currentStep+1,s.SFGuidedTourSteps[this.currentStep]},_isTourHidden:function(){return!!i("body").hasClass("sf-hidden")},_isLastStep:function(){return!(this.currentStep+1<s.SFGuidedTourSteps.length)},_lineBreaksToParagraphs:function(t){return"<p>"+t.replace("\n\n","</p><p>")+"</p>"}},i(document).ready(function(){s.SFGuidedTour.init()}))}(window.wp,jQuery);